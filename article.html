<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Straipsnis</title>
    <link rel="stylesheet" href="style.css">
    <script src="global.js" defer></script>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>VaistiniÅ³ AugalÅ³ Enciklopedija</h1>
            <button id="menu-toggle" aria-label="Meniu"><span></span><span></span><span></span></button>
        </div>
        <nav id="main-nav">
            <div id="nav-links">
                <a href="index.html">AugalÅ³ sÄ…raÅ¡as</a>
                <a href="map.html">AugintojÅ³ Å¾emÄ—lapis</a>
                <a href="blog.html">TinklaraÅ¡tis</a>
            </div>
        </nav>
    </header>

    <main>
        <a href="blog.html" style="margin-bottom: 1rem; display: inline-block;">&larr; Atgal Ä¯ tinklaraÅ¡tÄ¯</a>
        
        <div id="article-container" style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <p>Kraunamas straipsnis...</p>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const container = document.getElementById('article-container');

            console.log("1. Puslapis uÅ¾sikrovÄ—. IeÅ¡komas ID:", id); 

            if (!id) {
                container.innerHTML = '<p class="error">Klaida: Nuorodoje trÅ«ksta straipsnio ID.</p>';
                return;
            }

            // Svarbu: Naudojame get_article.php (VIENASKAITA)
            const apiUrl = `api/get_article.php?id=${id}`;
            console.log("2. Kreipiuosi Ä¯:", apiUrl);

            fetch(apiUrl)
                .then(response => {
                    console.log("3. Serverio atsakymo statusas:", response.status);
                    if (!response.ok) {
                        throw new Error(`Serverio klaida: ${response.status}`);
                    }
                    return response.json();
                })
                .then(article => {
                    console.log("4. Gauti duomenys:", article);

                    if (article.error) {
                        container.innerHTML = `<p class="error">${article.error}</p>`;
                        return;
                    }
                    
                    // Jei viskas gerai - atvaizduojame
                    let imageHtml = '';
                    if (article.image_url) {
                        let imagePath = article.image_url;
                        if (!imagePath.startsWith('uploads/') && !imagePath.startsWith('http')) {
                            imagePath = 'uploads/' + imagePath;
                        }
                        imageHtml = `<div class="blog-image-wrapper" style="height: 400px; margin-bottom: 20px;">
                                        <img src="${imagePath}" alt="${article.title}">
                                     </div>`;
                    }
                    
                    container.innerHTML = `
                        <div class="blog-content">
                            <span class="blog-date">ðŸ“… ${new Date(article.created_at).toLocaleDateString('lt-LT')}</span>
                            <h1 style="font-size: 2rem; margin-bottom: 1rem; color: var(--primary-dark);">${article.title}</h1>
                            ${imageHtml}
                            <div style="font-size: 1.1rem; line-height: 1.8; color: #333; white-space: pre-wrap;">${article.content}</div>
                        </div>
                    `;
                })
                .catch(err => {
                    console.error("5. KLAIDA:", err);
                    container.innerHTML = `<p class="error">Nepavyko uÅ¾krauti straipsnio. <br> <small>${err.message}</small></p>`;
                });
        });
    </script>
</body>
</html>